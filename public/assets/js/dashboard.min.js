$(document).foundation({equalizer:{equalize_on_stack:!0}});var galleryUpload={isUploading:!1,currentFile:null,queue:{}};$(document).ready(function(){if($(".write-post-form").length){var a=$(".write-post-form #editor");a.summernote({height:300,onImageUpload:function(b){UI.editorUploadImage(b[0],a)}}),$('.note-help, .note-view [data-name="fullscreen"]').remove(),$(".write-post-form").submit(function(b){b.preventDefault(),UI.clearAlertBoxes();var c=$(this).serializeObject();c.content=a.code(),$("[data-submit-form]").attr("disabled","disabled"),$.ajax($(this).attr("action"),{type:"post",data:JSON.stringify(c),contentType:"application/json",success:function(a){window.location=a.data.redirect},error:function(a,b,c){response=JSON.parse(a.responseText)||{message:"Error"},UI.addAlertBox("alert",response.message)},complete:function(){$("[data-submit-form]").removeAttr("disabled")}})}),$("[data-post-type]").click(function(){var a=$(this).data("post-type");$('.write-post-form input[name="post_type"]').val(a)})}$("[data-logout-href").click(function(a){a.preventDefault(),window.location=$(this).data("logout-href")}),$("[data-submit-form]").click(function(){var a=$(this).data("submit-form");$(a).submit()}),$("[data-click-proxy]").click(function(){var a=$(this).data("click-proxy");$(a).click()}),$(".gallery-manager .photo.add").click(function(){var a=$('<input type="file" name="image" accept="image/*" multiple />');a.click(),a.bind("change",function(){if(this.files){var a=this.files,b=0;!function c(){if(!(b>=a.length)){if(a[b].size>512e4)return void alert("Image must not exceed 512 kb");var d=new FileReader,e=UI.getImageCardTemplate();d.readAsDataURL(a[b]),d.onload=function(d){e.find(".thumb").css("background-image","url("+d.target.result+")"),e.attr("data-temp-id",Util.generateRandomString()),UI.addToGalleryManager(e),UI.galleryUploadImage(e,a[b]),b++,c()}}}()}})}),$(".gallery-manager").on("click",".photo .delete",function(){if(confirm("Are you sure you want to delete this photo?")){var a=$(this).parents("li");return a.find(".photo").is(".error, .queue")?(delete galleryUpload.queue[a.data("photo")],void a.fadeOut(function(){$(this).remove()})):void $.ajax({type:"delete",url:a.data("delete-url"),success:function(){a.fadeOut(function(){$(this).remove()})},error:function(){response=JSON.parse(xhr.responseText)||{message:"Error"},UI.addAlertBox("alert",response.message)}})}})}),jQuery.fn.serializeObject=function(){var a,b;return a=this.serializeArray(),b={},$.each(a,function(){var a="";null!=this.value&&(a=this.value),null!=b[this.name]?(b[this.name].push||(b[this.name]=[b[this.name]]),b[this.name].push(a)):b[this.name]=a}),b};var UI={addAlertBox:function(a,b){$(".alert-box-container").append('<div class="alert-box '+a+'">'+b+"</div>")},clearAlertBoxes:function(){$(".alert-box-container").empty()},showLoadingOverlay:function(){$(".loading-overlay").fadeIn(100)},hideLoadingOverlay:function(){$(".loading-overlay").fadeOut()},editorUploadImage:function(a,b){UI.showLoadingOverlay();var c=new FormData;c.append("image",a),$.ajax({type:"post",url:urls.postUpload,data:c,contentType:!1,processData:!1,success:function(a){b.summernote("insertImage",a)},error:function(a,b,c){response=JSON.parse(a.responseText)||{message:"Error"},UI.addAlertBox("alert",response.message)},complete:function(){UI.hideLoadingOverlay()}})},galleryUploadImage:function(a,b){if(galleryUpload.queue[a.data("temp-id")]||(galleryUpload.queue[a.data("temp-id")]=b),!galleryUpload.isUploading){galleryUpload.isUploading=!0;var c=a.find(".photo"),d=new FormData;d.append("gallery",a.data("gallery")),d.append("image",b),c.toggleClass("queue uploading"),$.ajax({type:"post",url:urls.galleryUpload,data:d,contentType:!1,processData:!1,xhr:function(){var a=$.ajaxSettings.xhr();return a.upload&&a.upload.addEventListener("progress",function(a){c.find(".progress-bar div").css("width",Math.floor(a.loaded/a.total*100)+"%")},!1),a},success:function(b){c.toggleClass("uploading success"),a.attr("data-delete-url",a.attr("data-delete-url").replace("-",a.data("gallery")).replace("--",b))},error:function(){c.toggleClass("uploading error")},complete:function(){delete galleryUpload.queue[a.data("temp-id")],galleryUpload.isUploading=!1;var b=Object.keys(galleryUpload.queue)[0];b&&UI.galleryUploadImage($('.gallery-manager [data-temp-id="'+b+'"]'),galleryUpload.queue[b])}})}},getImageCardTemplate:function(){return $($("template#photo-card").html())},addToGalleryManager:function(a){a.insertBefore(".gallery-manager .selector")}},Util={generateRandomString:function(){for(var a="",b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=0;8>c;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a}};